<!DOCTYPE html>
<html>
  <head>
    <title>Snake</title>

    <!-- Docs: https://alpinejs.dev/start-here -->
    <script src="https://unpkg.com/alpinejs" defer></script>

    <!-- Docs: https://tailwindcss.com/ -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body 
    autofocus 
    tabindex="-1"
    x-on:keyup="console.log($store.snake)"
    x-on:keydown.h="$store.snake.direction = 'left'"
    x-on:keydown.l="$store.snake.direction = 'right'"
    x-on:keydown.k="$store.snake.direction = 'up'"
    x-on:keydown.j="$store.snake.direction = 'down'"
  >
    <main class="flex flex-col items-center gap-4 mt-4"> 
      <div>
        Position: (<span x-text="$store.snake.x"></span>, <span x-text="$store.snake.y"></span>)
      </div>
      <table 
        class="border-spacing-0"
      >
        <tbody>
          <template x-for="row in 10">
            <tr class="border border-neutral" >
              <template x-for="col in 10">
                <td class="p-4 border border-neutral">
                  <span 
                    x-text="
                      $store.snake.x === col - 1 && $store.snake.y === row - 1
                      ? '**'
                      : col + row
                    "
                  >
                  </span>
                </td>
              </template>
            </tr>
          </template>
        </tbody>
      </table>
    </main>
  </body>
  <script>
    // define object stores
    document.addEventListener('alpine:init', () => {
      Alpine.store('food', {
        x: 0,
        y: 0,
        randomize() {
          this.x = Math.floor(Math.random() * 10);
          this.y = Math.floor(Math.random() * 10);
        }
      });
      Alpine.store('snake', {
        x: 0,
        y: 0,
        speed: 0,
        direction: 'right',
        move() {
          if (this.direction == 'left') {
            this.moveLeft();
          } else if (this.direction == 'right') {
            this.moveRight();
          } else if (this.direction == 'up') {
            this.moveUp();
          } else if (this.direction === 'down') {
            this.moveDown();
          }
        },
        moveLeft() {
          if (this.x === 0) {
          this.x = 9;
          } else {
          this.x -= 1;
          }
        },

        moveRight() {
          if (this.x === 9) {
          this.x = 0;
          } else {
          this.x += 1;
          }
        },

        moveUp() {
          if (this.y === 0) {
          this.y = 9;
          } else {
          this.y -= 1;
          }
        },

        moveDown() {
          if (this.y === 9) {
          this.y = 0;
          } else {
          this.y += 1;
          }
        },
      })

      // initialize the game
      Alpine.store('food').randomize();
      let lastMoveTime = 0;
      function render(time) {
        let snake = Alpine.store("snake");
        deltaTime = time - lastMoveTime;
        if (deltaTime > (1000 - snake.speed * 10)) {
          snake.moveRight();
          lastMoveTime = time;
        }
        requestAnimationFrame(render);
      }

      requestAnimationFrame(render);
    })
  </script>
</html>
